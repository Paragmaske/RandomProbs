SELECT 'NEML' AS SERVICE_PROVIDER,ORD_UNIQUE_NUMBER
AS AUCTION_ID_AS_PER_NAFED,ORD_PARAMVALUE9 AS Branch,ORD_PARAMVALUE7 AS Commodity,
ORD_PARAMVALUE8 AS SEASON,ORD_PARAMVALUE5 AS WAREHOUSE,(SELECT ROUND(ORD_ORD_QTY,2)
 FROM FO_ORDERS WHERE FO_ORDERS.ORD_BIDDING_START_TIME::date=current_timestamp::date
 AND FO_ORDERS.ORD_UNIQUE_NUMBER  = FO.ORD_UNIQUE_NUMBER
 and FO_ORDERS.ORD_EXCH_ORD_NO= FO.ord_auction_ord_no
  AND FO_ORDERS.ORD_ORD_TYPE ='AO' AND ORD_STATUS IN('FILL','PFILL','CNLS','OPEN') )
   AS TOTAL_QTY_OFFERED,ROUND(FO.ORD_SUPER_H1PRICE,2)
    AS BID_PRICE,
    (case when FO.ORD_SUPER_H1QTY is not null then ROUND(FO.ORD_SUPER_H1QTY,2) else
    ROUND(((SELECT ROUND(ORD_ORD_QTY,2) FROM FO_ORDERS
    WHERE FO_ORDERS.ORD_BIDDING_START_TIME::date=current_timestamp::date AND
    FO_ORDERS.ORD_UNIQUE_NUMBER  = FO.ORD_UNIQUE_NUMBER
     and FO_ORDERS.ORD_EXCH_ORD_NO= FO.ord_auction_ord_no AND
     FO_ORDERS.ORD_ORD_TYPE ='AO' AND ORD_STATUS IN('FILL','PFILL','CNLS','OPEN'))
     - FO.ord_super_h1matchqty),2) end) as BID_QTY, ROUND(PT.CONF_QTY,2) AS
      MATCHING_ROUND_QTY_MATCHED,'NEML'||PT.ORDER_ID AS
      MATCHING_ROUND_BIDDER_ID,ROUND(PT.ORDER_ORIGINAL_PRICE,2)
      AS MATCHING_ROUND_PRICE,ROUND(PT.ORDER_QTY,2) AS MATCHING_ROUND_QTY,
      to_char(PT.ORDER_TIME,'DD-MM-YYYY HH24:MI:SS')  AS
      MATCHING_ROUND_BID_LOG_TIME FROM fo_orders fo INNER JOIN PROVISIONAL_TRADE_MSTR pt
       ON FO.ORD_EXCH_ORD_NO =PT.ORDER_ID  LEFT JOIN TRADING_ACCOUNT CL  ON CL.CM_TM_ID
         = FO.ORD_TM_ID AND CL.CM_TRADINGACCNO = FO.ORD_TRD_ACC_NO WHERE PT.STATUS  ='CONF'
          AND FO.ORD_BIDDING_START_TIME::date=current_timestamp::date and ORD_PARAMVALUE9='%s'  and ORD_PARAMVALUE7 in ('URPSF','MOPSF','MAPSF','GRPSF','PSFTOOR','BULKTOOR')   AND FO.ord_contract_code IN (SELECT DISTINCT CC_CONTRACT_CODE FROM FO_CONT_COMM_STATE_MAPPING where cc_scheme = 'PSF')  ORDER BY FO.ORD_AUCTION_ORD_NO ASC, PT.ORDER_ORIGINAL_PRICE DESC,MATCHING_ROUND_QTY DESC,MATCHING_ROUND_BID_LOG_TIME asc